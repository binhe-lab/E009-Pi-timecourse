library(limma)
library(edgeR)

1# Input raw data
rawdata<-read.delim("Ex009.txt", check.names = FALSE, stringsAsFactors = FALSE)  ## for the logical arguments, space are needed
head(rawdata, n=3L) ## view first 3 rows of data
tail(rawdata, n=5L) ## view last 5 rows of data
y<-DGEList(count=rawdata[,1:4],genes=rawdata[,5]) ##small parentheses means function, [,]means lines or rows of matrix 



2# Normalization
y<-calcNormFactors(y) ##TMM normalization, based on the assumption that the majority of genes are not DEGs, method = c("TMM","RLE","upperquartile")
## The leading log-fold-change is the average (root-mean-square) of the largest absolute log-foldchanges between each pair of samples.
y$samples 
y$counts
y$genes
plotMDS(y) ##Plot samples on a two-dimensional scatterplot for any data object that can be coerced to a matrix, MDS:multi-dimentional scaling. 



3# Differential Expression - limma -trend
## assumption: 1,library size between samples is not variable;2,sequencing depth between samples is consistent
logCPM<-cpm(y,log = TRUE,prior.count=2) ## compute counts per million(CPM), log = TRUE then log2 values are returned, in this case, u need to set prior.count to avoid taking log of zero and damp down the variance of logarithms in low counts.
z<-rnorm(5595)

## need to design a matrix before fit them in linear model
fit<-lm.fit(logCPM,z) ## Questions: what is the matrix z here, I know we shoud have the same number of row as logCPM, but use what to fit linear model?

fit<-eBayes(fit, trend = TRUE)
##Error in eBayes(fit, trend = TRUE) : 
##Need Amean component in fit to estimate trend
